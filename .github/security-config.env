# Security threshold configuration for auth-service
# This file defines acceptable limits for vulnerabilities

# ==============================================
# VULNERABILITY THRESHOLDS
# ==============================================

# Security gate thresholds (blocks deployment)
SECURITY_GATE_CRITICAL_MAX=0        # No critical vulnerabilities tolerated
SECURITY_GATE_HIGH_MAX=5           # Maximum 5 high vulnerabilities
SECURITY_GATE_MEDIUM_MAX=20        # Maximum 20 medium vulnerabilities

# Alert thresholds (warning without blocking)
ALERT_HIGH_THRESHOLD=3             # Alert if more than 3 high
ALERT_MEDIUM_THRESHOLD=15          # Alert if more than 15 medium
ALERT_LOW_THRESHOLD=50            # Alert if more than 50 low

# ==============================================
# FORBIDDEN LICENSES
# ==============================================

# Licenses that block deployment
FORBIDDEN_LICENSES=(
    "GPL-3.0"
    "GPL-3.0+"
    "AGPL-3.0"
    "AGPL-3.0+"
    "SSPL-1.0"
    "Commons Clause"
)

# Licenses that trigger alerts
WARNING_LICENSES=(
    "GPL-2.0"
    "LGPL-3.0"
    "CDDL-1.0"
    "EPL-1.0"
    "MPL-2.0"
)

# ==============================================
# SBOM CONFIGURATION
# ==============================================

# Accepted SBOM formats
ACCEPTED_SBOM_FORMATS=(
    "spdx-json"
    "cyclonedx-json"
    "syft-json"
)

# Minimum tool versions
MIN_SYFT_VERSION="0.90.0"
MIN_GRYPE_VERSION="0.70.0"

# ==============================================
# REQUIRED ATTESTATIONS
# ==============================================

# Mandatory attestation types
REQUIRED_ATTESTATIONS=(
    "https://spdx.dev/Document"                    # SBOM
    "https://slsa.dev/provenance/v1"              # Provenance
)

# Optional but recommended attestation types
OPTIONAL_ATTESTATIONS=(
    "https://in-toto.io/Statement/v1"             # Test results
    "https://slsa.dev/verification_summary/v1"    # Verification summary
)

# ==============================================
# REPORTING CONFIGURATION
# ==============================================

# Report retention (in days)
REPORT_RETENTION_DAYS=90

# Output formats for reports
REPORT_FORMATS=(
    "json"
    "markdown"
    "html"
    "sarif"
)

# ==============================================
# EXTERNAL INTEGRATIONS
# ==============================================

# SonarQube configuration (if used)
SONARQUBE_QUALITY_GATE_TIMEOUT=300  # 5 minutes

# Slack/Teams configuration (notifications)
NOTIFICATION_CRITICAL_ENABLED=true
NOTIFICATION_HIGH_ENABLED=true
NOTIFICATION_DEPLOYMENT_SUCCESS=true

# ==============================================
# ENVIRONMENTS
# ==============================================

# Different thresholds per environment
declare -A ENV_CRITICAL_MAX=(
    ["production"]=0
    ["staging"]=1
    ["development"]=3
)

declare -A ENV_HIGH_MAX=(
    ["production"]=3
    ["staging"]=10
    ["development"]=20
)

# ==============================================
# ANALYSIS TOOLS
# ==============================================

# Grype configuration
GRYPE_DB_AUTO_UPDATE=true
GRYPE_DB_CACHE_DIR="/tmp/grype-db"
GRYPE_FAIL_ON_SEVERITY="critical"

# Trivy configuration
TRIVY_CACHE_DIR="/tmp/trivy-cache"
TRIVY_TIMEOUT="10m"
TRIVY_SKIP_UPDATE=false

# ==============================================
# EXCLUSIONS
# ==============================================

# CVEs to ignore (with justification)
IGNORED_CVES=(
    # "CVE-2023-XXXXX"  # Example: False positive confirmed by security team
)

# Packages to exclude from analysis (dev dependencies, etc.)
EXCLUDED_PACKAGES=(
    "@types/*"
    "jest"
    "prettier"
    "eslint*"
)

# ==============================================
# METRICS AND MONITORING
# ==============================================

# Metrics collection
METRICS_ENABLED=true
METRICS_RETENTION_DAYS=365

# Metrics to collect
COLLECT_METRICS=(
    "vulnerability_count_by_severity"
    "sbom_package_count"
    "attestation_verification_status"
    "security_gate_pass_rate"
    "license_compliance_rate"
)

# ==============================================
# AUTOMATIC ACTIONS
# ==============================================

# Automatically create issues for critical vulnerabilities
AUTO_CREATE_ISSUES=true
ISSUE_LABELS=("security" "vulnerability" "auto-generated")

# Automatically create PRs for security updates
AUTO_SECURITY_UPDATES=false  # Enable with caution

# Automatic team notification
AUTO_NOTIFY_SECURITY_TEAM=true
AUTO_NOTIFY_DEVOPS_TEAM=true